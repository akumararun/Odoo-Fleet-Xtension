<?xml version="1.0" encoding="UTF-8"?>
<openerp>
	<data>

		<menuitem name="Service Center" parent="fleet.menu_root" id="fleet_services"
			sequence="3" groups="fleet.group_fleet_user" />
		<menuitem action="fleet.fleet_vehicle_log_services_act"
			sequence="4" parent="fleet_services" id="fleet.fleet_vehicle_log_services_menu"
			groups="fleet.group_fleet_user" />

		<menuitem action="fleet.fleet_vehicle_log_contract_act" parent="fleet_services" sequence="0"
		id="fleet.fleet_vehicle_log_contract_menu" groups="fleet.group_fleet_user"/>
		
		
		<!-- ALerts -->
		  <!-- alert -->
        
        <record id="fleet_service_alert_tree" model="ir.ui.view">
            <field name="name">fleet.service.alert.tree</field>
            <field name="model">fleet.service.alert</field>
            <field name="arch" type="xml">
                <tree string="Service Alerts" colors="red:state == 'overdue';black:state in ('open',);gray:state in('cancel','done')">
                    <field name="name"/>
                    <field name="vehicle_id"/>
                    <field name="date_scheduled"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>
        
        <record id="view_service_alert_calendar" model="ir.ui.view">
            <field name="name">Service Alert Calendar</field>
            <field name="model">fleet.service.alert</field>
            <field name="arch" type="xml">
                <calendar string="Service Alerts" color="vehicle_id"
                          date_start="date_scheduled" 
                          quick_add="False" avatar_model="fleet.vehicle">
                    <field name="vehicle_id"/>
                </calendar>
            </field>
        </record>
    
        
        <record id="view_fleet_service_alert_filter" model="ir.ui.view">
            <field name="name">fleet.service.alert.filter</field>
            <field name="model">fleet.service.alert</field>
            <field name="arch" type="xml">
                <search string="Search Alerts">
                    <field name="name"/>
                    <separator/>
                    <filter icon="terp-check" domain="[('state','=','open')]" string="Active" name="active"/>
                    <filter icon="terp-camera_test" domain="[('state','=','overdue')]" string="Overdue" name="overdue"/>
                    <filter icon="terp-camera_test" domain="[('state','in',('open','overdue'))]" string="Need Action" name="needaction"/>
                    <separator/>
                    <field name="vehicle_id"/>
                    <group expand="0" string="Group By...">
                        <filter name="group_date" string="Scheduled Date" icon="terp-personal" domain="[]" context="{'group_by':'date_scheduled'}"/>
                        <filter string="State" icon="terp-stock_effects-object-colorize" domain="[]" context="{'group_by':'state'}"/>
                    </group>
                </search>
            </field>
        </record>
        
        <record id="fleet_service_alert_form" model="ir.ui.view">
            <field name="name">fleet.service.alert.form</field>
            <field name="model">fleet.service.alert</field>
            <field name="arch" type="xml">
                <form string="Service Alert">
                    <header>
                        <button name="action_log_service" type="object" string="Mark Done" states="open,overdue" class="oe_highlight" groups="fleet.group_fleet_manager"/>
                        <button name="action_cancel" type="object" states="open,overdue" groups="fleet.group_fleet_manager" string="Cancel"/>
                        <field name="state" widget="statusbar"/>
                    </header>
                    <sheet>
                    <group>
                        <group>
                        	<field name="name"/>
                            <field name="vehicle_id" options="{'no_create': True}"/>
                            <field name="service_log_id"/>
                        </group>
                        <group>
                            
							<field name="date"/>
							<field name="date_scheduled"/>
							<field name="date_closed"/>
                        </group>
                       
                    </group>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>
        
        <record id="open_fleet_service_alerts" model="ir.actions.act_window">
            <field name="name">Service Alerts</field>
            <field name="res_model">fleet.service.alert</field>
            <field name="view_type">form</field>
            <field name="view_mode">calendar,tree,form</field>
            <field name="context">{"search_default_needaction":1}</field>
			<field name="search_view_id" ref="view_fleet_service_alert_filter"/>
        </record>
        
        <menuitem id="menu_fleet_service_alert"
            action="open_fleet_service_alerts"
            groups="fleet.group_fleet_user"
            parent="fleet_services"
            sequence="15"/>
		
		
		
		
		<!-- Overrides -->
		<record id="fleet_vehicle_log_services_form" model="ir.ui.view">
			<field name="name">fleet.vehicle.log.service.form.inherit</field>
			<field name="model">fleet.vehicle.log.services</field>
			<field name="inherit_id" ref="fleet.fleet_vehicle_log_services_form" />
			<field name="arch" type="xml">
			
				<field name="vehicle_id" position="after">
					<field name="alert_id" />
				</field>
				
				<xpath expr="/form/sheet/group[1]" position="before">
				    <div class="oe_title">
                            <label for="name" class="oe_edit_only"/>
                            <h1><field name="name" class="oe_inline"/></h1>
                        </div>
				</xpath>
				
			</field>
		</record>
		
		 <record model='ir.ui.view' id='fleet_vehicle_log_services_search'>
            <field name="name">fleet.vehicle.log.services.search</field>
            <field name="model">fleet.vehicle.log.services</field>
            <field name="inherit_id" ref="fleet.fleet_vehicle_log_services_search" />
            <field name="arch" type="xml">
                <field name="vehicle_id" position="before">
                    <field name="name"/>
                </field>
            </field>
        </record>
        
        <record model='ir.ui.view' id='fleet_vehicle_log_services_tree'>
            <field name="name">fleet.vehicle.log.services.tree</field>
            <field name="model">fleet.vehicle.log.services</field>
            <field name="inherit_id" ref="fleet.fleet_vehicle_log_services_tree" />
            <field name="arch" type="xml">
                    <field name="date" position="before" >
                        <field name="name"/>
                    </field>
            </field>
        </record>
		
		
		<record id="fleet_x_fuel_vehicle_form" model="ir.ui.view">
			<field name="name">fleet.vehicle.form.inherit</field>
			<field name="model">fleet.vehicle</field>
			<field name="inherit_id" ref="fleet_x.fleet_x_vehicle_form" />
			<field name="arch" type="xml">
			
					<page string="Policies" position="inside">
						<group string="Service Scheduling">
							<group>
								<field name="repair_scheduling_interval"/> 
							</group> 
							<group>
								<field name="repair_scheduling_time" attrs="{'invisible': [('repair_scheduling_interval','=','odometer')], 'required': [('repair_scheduling_interval','!=','odometer')]}"/> 
								<field name="repair_scheduling_odometer" attrs="{'invisible': [('repair_scheduling_interval','=','time')], 'required': [('repair_scheduling_interval','!=','time')]}"/> 
							</group> 
							
						</group> 
					</page>
               	
               	<button name="action_get_attachment_tree_view" position="before">
               		<button name="%(open_fleet_service_alerts)d"
                    			context="{'search_default_vehicle_id': [active_id],'default_vehicle_id': active_id}"
                                type="action"
                                class="oe_stat_button"
                                icon="fa-exclamation-triangle"
                                >
                                <field name="alert_count" widget="statinfo" string="Alerts"/>
                            </button>
               	</button>
			</field>
		</record>
		
		


	</data>
</openerp>

